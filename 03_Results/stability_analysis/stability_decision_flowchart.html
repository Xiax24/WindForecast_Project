<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>昌马站稳定度决策流程图</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .flowchart {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .step {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            position: relative;
        }
        
        .input {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 5px solid #2196f3;
        }
        
        .calculation {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border-left: 5px solid #9c27b0;
        }
        
        .decision {
            background: linear-gradient(135deg, #fff3e0, #ffcc80);
            border-left: 5px solid #ff9800;
            border-radius: 15px;
        }
        
        .verification {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-left: 5px solid #4caf50;
        }
        
        .output {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border-left: 5px solid #f44336;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #34495e;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .arrow {
            text-align: center;
            font-size: 24px;
            color: #34495e;
            margin: 10px 0;
        }
        
        .formula {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        
        .priority-box {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        
        .priority-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #ddd;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .priority-1 { border-color: #e74c3c; background: #fdf2f2; }
        .priority-2 { border-color: #f39c12; background: #fef9e7; }
        .priority-3 { border-color: #f1c40f; background: #fffbf0; }
        .priority-4 { border-color: #95a5a6; background: #f8f9fa; }
        
        .confidence-box {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .confidence-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #ddd;
            text-align: center;
        }
        
        .high-conf { border-color: #27ae60; background: #eafaf1; }
        .medium-conf { border-color: #f39c12; background: #fef9e7; }
        .low-conf { border-color: #e74c3c; background: #fdf2f2; }
        
        .legend {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 1px solid #dee2e6;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .legend-item {
            display: inline-block;
            margin: 5px 15px 5px 0;
            font-size: 14px;
        }
        
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 15px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="flowchart">
        <div class="title">昌马站大气稳定度决策流程图</div>
        
        <!-- 输入阶段 -->
        <div class="step input">
            <span class="step-number">1</span>
            <strong>数据输入阶段</strong><br>
            输入多层风速观测数据：V₁₀ₘ, V₃₀ₘ, V₅₀ₘ, V₇₀ₘ<br>
            辅助数据：10m温度、时间信息
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 计算阶段 -->
        <div class="step calculation">
            <span class="step-number">2</span>
            <strong>风切变参数计算</strong><br>
            计算所有可能的α值组合：
            <div class="priority-box">
                <div class="priority-item priority-1">
                    <strong>α₁₀₋₇₀</strong><br>
                    主要指标<br>
                    ln(V₇₀/V₁₀)/ln(7)
                </div>
                <div class="priority-item priority-2">
                    <strong>α₁₀₋₃₀</strong><br>
                    备选1<br>
                    ln(V₃₀/V₁₀)/ln(3)
                </div>
                <div class="priority-item priority-3">
                    <strong>α₃₀₋₅₀</strong><br>
                    备选2<br>
                    ln(V₅₀/V₃₀)/ln(1.67)
                </div>
                <div class="priority-item priority-4">
                    <strong>α₅₀₋₇₀</strong><br>
                    备选3<br>
                    ln(V₇₀/V₅₀)/ln(1.4)
                </div>
            </div>
            <div style="background: #e8f4fd; padding: 8px; border-radius: 5px; margin-top: 8px; font-size: 12px;">
                <strong>优先级设定依据：</strong><br>
                • Optis et al. (2016). Wind Energy - 近地层稳定度重要性<br>
                • Risan et al. (2018). Remote Sensing - 复杂地形风剖面特征有效性
            </div>
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 主决策阶段 -->
        <div class="step decision">
            <span class="step-number">3</span>
            <strong>主要稳定度分类决策（权重70%）</strong><br>
            <strong>选择策略：</strong>按优先级选择第一个有效α值
            <div class="formula">
                if α_main < 0.1  → <strong>unstable</strong> (不稳定)<br>
                if 0.1 ≤ α_main ≤ 0.3 → <strong>neutral</strong> (中性)<br>
                if α_main > 0.3  → <strong>stable</strong> (稳定)
            </div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <strong>关键：</strong>这一步决定最终的stability_final结果！<br>
                后续验证只影响置信度，不改变分类结果
            </div>
            <div style="background: #e8f4fd; padding: 8px; border-radius: 5px; margin-top: 8px; font-size: 12px;">
                <strong>文献支撑：</strong><br>
                • Emeis, S. (2013). Wind energy meteorology - 标准α值分类阈值<br>
                • Wharton & Lundquist (2012). Environmental Research Letters - 风电场α值有效性验证
            </div>
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 验证阶段1 -->
        <div class="step verification">
            <span class="step-number">4</span>
            <strong>多层一致性验证（权重20%）</strong><br>
            比较各层α值的分类结果，计算一致性评分：
            <div class="formula">
                consistency_score = 一致分类数量 / 总有效分类数量<br>
                例：4个α值中3个分类为neutral → score = 3/4 = 0.75
            </div>
            <strong>置信度调整：</strong><br>
            • score ≥ 0.8: confidence +0.15 (高一致性)<br>
            • score < 0.5: confidence -0.10 (低一致性)
            <div style="background: #e8f4fd; padding: 8px; border-radius: 5px; margin-top: 8px; font-size: 12px;">
                <strong>方法依据：</strong><br>
                • Risan et al. (2018). Remote Sensing - 风剖面一致性验证方法<br>
                • Barthelmie et al. (1993). Boundary-Layer Meteorology - 多因素验证框架
            </div>
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 验证阶段2 -->
        <div class="step verification">
            <span class="step-number">5</span>
            <strong>物理合理性验证（权重10%）</strong><br>
            检验分类结果的物理合理性：
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 10px 0;">
                <div style="background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <strong>时间一致性：</strong><br>
                    • 夜间(18:00-6:00) → 偏向stable<br>
                    • 白天(6:00-18:00) → 偏向unstable
                </div>
                <div style="background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <strong>温度一致性：</strong><br>
                    • 快速升温(>0.5°C/h) → unstable<br>
                    • 快速降温(<-0.5°C/h) → stable
                </div>
            </div>
            <strong>置信度调整：</strong><br>
            • consistent: confidence +0.10<br>
            • inconsistent: confidence -0.15
            <div style="background: #e8f4fd; padding: 8px; border-radius: 5px; margin-top: 8px; font-size: 12px;">
                <strong>理论基础：</strong><br>
                • Gualtieri, G. (2019). Renewable and Sustainable Energy Reviews - 组合策略理论<br>
                • Peña et al. (2010). Theoretical and Applied Climatology - 温度梯度与稳定度关系
            </div>
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 质量控制 -->
        <div class="step verification">
            <span class="step-number">6</span>
            <strong>质量控制调整</strong><br>
            额外的质量检查和置信度调整：
            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                <div style="background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd; flex: 1; margin-right: 10px;">
                    <strong>低风速检查：</strong><br>
                    V₁₀ₘ或V₇₀ₘ < 1.0 m/s<br>
                    → confidence -0.10
                </div>
                <div style="background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd; flex: 1;">
                    <strong>极端α值检查：</strong><br>
                    |α_main| > 1.0<br>
                    → confidence -0.10
                </div>
            </div>
        </div>
        
        <div class="arrow">↓</div>
        
        <!-- 最终输出 -->
        <div class="step output">
            <span class="step-number">7</span>
            <strong>最终结果输出</strong><br>
            <div class="confidence-box">
                <div class="confidence-item high-conf">
                    <strong>高质量结果</strong><br>
                    confidence ≥ 0.8<br>
                    data_quality = "high"
                </div>
                <div class="confidence-item medium-conf">
                    <strong>中等质量结果</strong><br>
                    0.6 ≤ confidence < 0.8<br>
                    data_quality = "medium"
                </div>
                <div class="confidence-item low-conf">
                    <strong>低质量结果</strong><br>
                    confidence < 0.6<br>
                    data_quality = "low"
                </div>
            </div>
            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #c3e6cb;">
                <strong>最终输出：</strong><br>
                • <strong>stability_final</strong>: 基于步骤3的α值分类结果<br>
                • <strong>confidence_final</strong>: 经过所有调整后的置信度<br>
                • <strong>data_quality</strong>: 基于置信度的质量等级<br>
                • <strong>quality_flags</strong>: 详细的质量标记信息
            </div>
        </div>
        
        <!-- 图例说明 -->
        <div class="legend">
            <div class="legend-title">流程图说明</div>
            <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb);"></span>
                输入阶段
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(135deg, #f3e5f5, #e1bee7);"></span>
                计算阶段
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(135deg, #fff3e0, #ffcc80);"></span>
                决策阶段
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9);"></span>
                验证阶段
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: linear-gradient(135deg, #ffebee, #ffcdd2);"></span>
                输出阶段
            </div>
            
            <div style="margin-top: 15px;">
                <strong>关键要点：</strong><br>
                1. <strong>最终稳定度分类100%由风切变参数α决定</strong>（步骤3）<br>
                2. <strong>验证步骤只影响置信度，不改变分类结果</strong><br>
                3. <strong>α值选择优先级</strong>：α₁₀₋₇₀ > α₁₀₋₃₀ > α₃₀₋₅₀ > α₅₀₋₇₀<br>
                4. <strong>置信度反映分类质量</strong>：高置信度表示多层验证一致，物理合理
            </div>
            
            <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">
                <strong>核心参考文献：</strong><br>
                <div style="font-size: 13px; line-height: 1.6; margin-top: 8px;">
                    • <strong>Emeis, S. (2013).</strong> Wind energy meteorology: atmospheric physics for wind power generation. Springer.<br>
                    • <strong>Wharton, S., & Lundquist, J.K. (2012).</strong> Atmospheric stability affects wind turbine power collection. Environmental Research Letters, 7(1), 014005.<br>
                    • <strong>Gualtieri, G. (2019).</strong> A comprehensive review on wind resource extrapolation models applied in wind energy. Renewable and Sustainable Energy Reviews, 102, 215-233.<br>
                    • <strong>Risan, A., et al. (2018).</strong> Wind in complex terrain - lidar measurements for evaluation of CFD simulations. Remote Sensing, 10(1), 59.<br>
                    • <strong>Optis, M., et al. (2016).</strong> Limitations and breakdown of Monin–Obukhov similarity theory for wind profile extrapolation under stable stratification. Wind Energy, 19(6), 1053-1072.<br>
                    • <strong>Peña, A., et al. (2010).</strong> Comparing mixing-length models of the diabatic wind profile over homogeneous terrain. Theoretical and Applied Climatology, 100(3-4), 325-335.<br>
                    • <strong>Barthelmie, R.J., et al. (1993).</strong> Estimation of sector roughness and the effect on prediction of the vertical wind speed profile. Boundary-Layer Meteorology, 66(1-2), 19-47.
                </div>
            </div>
        </div>
    </div>
</body>
</html>